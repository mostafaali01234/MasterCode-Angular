<h1>{{title}}</h1>
<form (submit)="addNewOrder()" (keydown)="onKeyDown($event)">

    <div class="row">
        <div class="form-group col-md-6">
            <label for="name">تاريخ الاوردر</label>
            <!-- <input type="date" [(ngModel)]="newOrder.orderHeader.orderDate" required class="form-control" -->
            <input type="date" [ngModel]="newOrder.orderHeader.orderDate | date:'yyyy-MM-dd'" (ngModelChange)="newOrder.orderHeader.orderDate = $event" required class="form-control"
                id="orderHeader.orderDate" name="orderHeader.orderDate">
        </div>
        <div class="form-group col-md-6">
            <label for="name">البائع</label>
            <select class="form-control" [(ngModel)]="newOrder.orderHeader.applicationUserId" required
                id="orderHeader.applicationUserId" name="orderHeader.applicationUserId">
                @for(cat of emps;track cat.id)
                {
                <option [value]="cat.id">{{cat.name}}</option>
                }
            </select>
        </div>
    </div>

    <div class="row">
        <div class="form-group col-md-6">
            <label for="name">بحث عن العميل بالاسم/الرقم</label>
            <input type="text" class="form-control" [(ngModel)]="customerSearchText" name="customerSearchText" id="customerSearchText" />
        </div>
        <div class="form-group col-md-6">
            <label for="name">العميل</label>
            <select class="form-control" [(ngModel)]="newOrder.orderHeader.customerId" required
                id="orderHeader.customerId" name="orderHeader.customerId">
                @for(cat of customers;track cat.id)
                {
                <option [value]="cat.id">{{cat.customerName}}</option>
                }
            </select>
        </div>
    </div>

    <div class="row">
        <div class="form-group col-md">
            <label for="name">ملاحظات</label>
            <input type="text" [(ngModel)]="newOrder.orderHeader.orderNotes" class="form-control"
                id="orderHeader.orderNotes" name="orderHeader.orderNotes">
        </div>
    </div>

    <hr />

    <h3>المنتجات</h3>
    <div class="row">
        <div class="form-group col-md-4">
            <label for="name">بحث عن المنتج بالاسم</label>
            <input type="text" class="form-control" [(ngModel)]="productSearchText" name="productSearchText" id="productSearchText" />
        </div>
        <div class="form-group col-md-4">
            <label for="name">المنتج</label>
            <select class="form-control" [(ngModel)]="newDet.productId" required (change)="getProductInfo()"
                id="productId" name="productId">
                @for(cat of products;track cat.id)
                {
                <option [value]="cat.id">{{cat.title}}</option>
                }
            </select>
        </div>
        <div class="form-group col-md-4">
            <label for="name">الكمية</label>
            <input type="number" [(ngModel)]="newDet.count" required class="form-control"
                id="count" name="count">
        </div>
    </div>
    <div class="row">
        <div class="form-group col-md-4">
            <label for="name">سعر الوحدة</label>
            <input type="number" [(ngModel)]="newDet.price" required class="form-control"
                id="price" name="price">
        </div>
         <div class="form-group col-md-4">
            <label for="name">الاجمالي</label> 
            <input type="number" [(ngModel)]="newDet.totalPrice" class="form-control" disabled value="{{newDet.count * newDet.price}}"
            id="totalPrice" name="totalPrice">
        </div>
        <div class="form-group col-md-4">
             <label for="name">.</label> 
             <button type="button" class="btn btn-primary form-control" (click)="AddToCart()">اضافة</button>
        </div>
    </div>
  
     <hr />

    <table class="table table-bordered">
        <thead>
            <tr>
                <th>المنتج</th>
                <th>الكمية</th>
                <th>سعر الوحدة</th>
                <th>الاجمالي</th>
                <th>حذف</th>
            </tr>
        </thead>
        <tbody>
            @for(det of dets;track det.id)
            {
                <tr>
                    <td hidden>{{det.id}}</td>
                    <td>{{det.productName}}</td>
                    <td>{{det.count}}</td>
                    <td>{{det.price}}</td>
                    <td>{{det.totalPrice}}</td>
                    <td><button  type="button" (click)="removeFromCart(det.id)" class="btn btn-danger">حذف</button></td>
                </tr>
            }
        </tbody>
        <tfoot>
            <tr>
                <td colspan="3">الاجمالي</td>
                <!-- <td>{{newOrder.orderHeader.orderTotal}}</td> -->
                <td colspan="3">{{getDetsSum()}}</td>
            </tr>   
        </tfoot>
    </table>

     <hr />

    <button type="submit" class="btn btn-success mt-3 form-control">{{btnTxt}}</button>

    <button (click)="gotoOrdersPage()" class="btn btn-secondary mt-3 form-control">العودة</button>
</form>